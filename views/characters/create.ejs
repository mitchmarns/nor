<div class="dashboard-hero">
  <h1 class="dashboard-welcome page-title">CREATE CHARACTER</h1>
</div>

<div class="row">
  <div class="col-12 col-md-8 mx-auto">
    <form action="/characters/create" method="POST" class="card p-4">
      <div class="mb-4">
        <h2 class="mb-2 card-title">Character Details</h2>
      </div>
      <div class="form-group mb-3">
        <label for="name" class="card-info-label">Name</label>
        <input type="text" id="name" name="name" class="form-control" required>
      </div>
      <div class="form-group mb-3">
        <label for="nickname" class="card-info-label">Nickname</label>
        <input type="text" id="nickname" name="nickname" class="form-control">
      </div>
      <div class="form-group mb-3">
        <label for="age" class="card-info-label">Age</label>
        <input type="number" id="age" name="age" class="form-control" min="0">
      </div>
      <div class="form-group mb-3">
        <label for="avatarUrl" class="card-info-label">Avatar URL</label>
        <input type="url" id="avatarUrl" name="avatarUrl" class="form-control" placeholder="https://example.com/avatar.png" oninput="updateAvatarPreview()">
        <small class="form-text text-muted">Paste a direct link to your character's avatar (optional)</small>
        <div id="avatarPreview" class="mt-2" style="display:none;">
          <img src="" alt="Avatar Preview" class="character-avatar" style="max-width:120px;max-height:120px;border-radius:8px;">
        </div>
      </div>
      <div class="form-group mb-3">
        <label for="teamId" class="card-info-label">Team</label>
        <select id="teamId" name="teamId" class="form-control">
          <option value="">No Team</option>
          <% if (typeof teams !== 'undefined' && teams.length > 0) { %>
            <% teams.forEach(team => { %>
              <option value="<%= team.id %>"><%= team.name %></option>
            <% }); %>
          <% } %>
        </select>
      </div>
      <div class="form-row mb-3">
        <div class="col">
          <label for="role" class="card-info-label">Role</label>
          <select id="role" name="role" class="form-control" required>
            <option value="Player">Player</option>
            <option value="Staff">Staff</option>
            <option value="Civilian">Civilian</option>
          </select>
        </div>
        <div class="col">
          <label for="position" class="card-info-label">Position</label>
          <input type="text" id="position" name="position" class="form-control">
        </div>
        <div class="col">
          <label for="jerseyNumber" class="card-info-label">Jersey #</label>
          <input type="number" id="jerseyNumber" name="jerseyNumber" class="form-control" min="0">
        </div>
      </div>
      <div class="form-group mb-3">
        <label for="shortBio" class="card-info-label">Short Bio</label>
        <textarea id="shortBio" name="shortBio" class="form-control" rows="3" maxlength="200"></textarea>
        <small class="form-text text-muted">A brief summary (max 200 characters)</small>
      </div>
      <div class="form-group mb-3">
        <label for="bio" class="card-info-label">Full Bio</label>
        <textarea id="bio" name="bio" class="form-control" rows="6"></textarea>
      </div>
      <div class="form-row justify-content-between align-items-center mt-4">
        <button type="submit" class="btn btn-primary btn-create">Create Character</button>
        <a href="/characters" class="btn btn-secondary ml-2">Cancel</a>
      </div>
    </form>
  </div>
</div>

<script>
  function updateAvatarPreview() {
    const url = document.getElementById('avatarUrl').value;
    const preview = document.getElementById('avatarPreview');
    const img = preview.querySelector('img');
    if (url && /^https?:\/\/.+\.(jpg|jpeg|png|gif|svg|webp)$/i.test(url)) {
      img.src = url;
      preview.style.display = 'block';
    } else {
      preview.style.display = 'none';
      img.src = '';
    }
  }
</script>